<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Subir Capítulo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h2>📖 Subir nuevo capítulo</h2>
    <form id="capitulo-form" enctype="multipart/form-data">
        <label>ID Manhwa:</label>
        <input type="number" id="id_manhwa" name="id_manhwa" required>

        <label>Número de capítulo:</label>
        <input type="number" id="numero" name="numero" required>

        <label>Título (opcional):</label>
        <input type="text" id="titulo" name="titulo">

        <label>Imágenes:</label>
        <input type="file" id="imagenes" name="imagenes" multiple accept="image/*" required>

        <button type="submit">Subir capítulo</button>
    </form>

    <script>
        document.getElementById("capitulo-form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const submitButton = e.target.querySelector("button");
            submitButton.disabled = true;
            submitButton.textContent = "Subiendo...";

            try {
                const res = await fetch("https://manhwashaven.onrender.com/api/capitulos/subir", {
                    method: "POST",
                    body: formData
                });

                const data = await res.json();
                alert(data.msg || "Capítulo procesado correctamente.");

                if (res.ok) e.target.reset();
            } catch (error) {
                console.error("❌ Error al subir el capítulo:", error);
                alert("No se pudo conectar con el servidor. Intenta nuevamente.");
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = "Subir capítulo";
            }
        });
    </script>

</body>
</html>
