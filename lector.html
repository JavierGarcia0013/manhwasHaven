<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lector de Capítulo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1><a href="biblioteca.html"><span class="manhwas">MANHWAS</span> <span class="haven">HAVEN</span></a></h1>
    </header>

    <main>
        <h2 id="titulo"></h2>
        <div id="imagenes"></div>
        <div id="nav">
            <button id="prev">Anterior</button>
            <button id="next">Siguiente</button>
        </div>
    </main>

    <script>
    const params = new URLSearchParams(window.location.search);
    const nombre = params.get("nombre");
    let capitulo = params.get("capitulo");

    document.getElementById("titulo").textContent = `${nombre} - ${capitulo}`;

        async function cargarImagenes() {
            try {
                const res = await fetch(`https://manhwashaven.onrender.com/api/capitulos/imagenes/${encodeURIComponent(capitulo)}`);
                const data = await res.json();

                const contenedor = document.getElementById("imagenes");
                contenedor.classList.remove("loaded");

                contenedor.innerHTML = data
                    .map(img => `<img src="https://manhwashaven.onrender.com${img.url_imagen}" class="pagina">`)
                    .join("");

                // efecto de aparición suave
                setTimeout(() => contenedor.classList.add("loaded"), 50);
            } catch (err) {
                console.error("Error al cargar imágenes:", err);
                document.getElementById("imagenes").innerHTML = "<p>Error al cargar imágenes.</p>";
            }

        }


    document.getElementById("prev").onclick = () => {
      const num = parseInt(capitulo.split("-")[1]) - 1;
      if (num >= 1) window.location.href = `lector.html?nombre=${nombre}&capitulo=capitulo-${num}`;
    };
    document.getElementById("next").onclick = () => {
      const num = parseInt(capitulo.split("-")[1]) + 1;
      window.location.href = `lector.html?nombre=${nombre}&capitulo=capitulo-${num}`;
    };

    cargarImagenes();
    </script>
</body>
</html>
