<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="6a97888e-site-verification" content="86b2b810827fe9b4c03002d1331dacf0">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manhwas Haven - Inicio</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="app.js" defer></script>
</head>

<body>
    <header>
        <div class="top-bar">
            <h1>
                <a href="index.html"><span class="manhwas">MANHWAS</span> <span class="haven">HAVEN</span></a>
            </h1>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Buscar..." />
            </div>
            <div class="user-actions" id="user-actions">
                <a href="iniciar-sesion.html" class="user-btn">Iniciar Sesión</a>
                <a href="registrarse.html" class="user-btn highlight">Registrar</a>
            </div>
        </div>

        <div class="nav-bar">
            <nav class="nav-links">
                <a href="index.html">Inicio</a>
                <a href="biblioteca.html">Biblioteca</a>
                <a href="mis-manhwas.html">Mis Manhwas</a>
                <a href="perfil.html">Mi Perfil</a>
                <a href="subir-manhwa.html" id="btn-subir-manhwa" class="highlight">Subir Manhwa</a>
            </nav>
        </div>

        <div class="upload-container">
            <button id="btn-subir-manhwa" class="auth-btn" style="display:none;">Subir Manhwa</button>
        </div>

    </header>


    <main>
        <section class="intro">
            <h2>Últimos Manhwas</h2>
            <p>Explora los títulos más recientes y populares de la comunidad.</p>
        </section>

        <section id="destacados" class="carousel-section">
            <h2>📚 Destacados</h2>
            <div class="carousel-container">
                <button id="prev" class="carousel-btn">‹</button>
                <div id="carousel" class="carousel"></div>
                <button id="next" class="carousel-btn">›</button>
            </div>
        </section>


        <section id="ultimos-manhwas" class="grid">
            <!-- Aquí se cargarán los manhwas más recientes -->
        </section>
        <script>
            fetch("https://manhwashaven.onrender.com/api/manhwas")
                .then(res => res.json())
                .then(manhwas => {
                    const recientes = manhwas.filter(m => {
                        const fecha = new Date(m.fecha_subida || Date.now());
                        const ahora = new Date();
                        return (ahora - fecha) <= 24 * 60 * 60 * 1000; // últimos 24 h
                    });

                    const cont = document.getElementById("ultimos-manhwas");
                    cont.innerHTML = recientes.length
                        ? recientes.map(m => `
                                        <div class="manhwa-card" style="cursor:pointer" onclick="window.location='manhwa.html?nombre=${m.nombre}&cap=capitulo-1'">
                                         <img src="https://manhwashaven.onrender.com${m.portada}" alt="${m.nombre}">
                                          <h4>${m.nombre}</h4>
                                          <button class="leer-btn">Leer</button>
                                        </div>
                                      `).join("")
                        : "<p>No hay nuevos manhwas recientes.</p>";
                });

        </script>
        <script>
            async function cargarDestacados() {
                try {
                    const res = await fetch("https://manhwashaven.onrender.com/api/manhwas");
                    const manhwas = await res.json();

                    // Simulación de "más leídos": los primeros 10
                    const destacados = manhwas.slice(0, 10);

                    const carousel = document.getElementById("carousel");
                    carousel.innerHTML = destacados.map(m => `
                              <div class="carousel-item" onclick="window.location='manhwa.html?nombre=${m.nombre}'">
                                <img src="https://manhwashaven.onrender.com${m.portada}" alt="${m.nombre}">
                                <h4>${m.nombre}</h4>
                              </div>
                            `).join("");

                    // Controles del carrusel
                    let scrollPos = 0;
                    const scrollStep = 220;

                    document.getElementById("next").onclick = () => {
                        scrollPos = Math.min(scrollPos + scrollStep, carousel.scrollWidth - carousel.clientWidth);
                        carousel.scrollTo({ left: scrollPos, behavior: "smooth" });
                    };
                    document.getElementById("prev").onclick = () => {
                        scrollPos = Math.max(scrollPos - scrollStep, 0);
                        carousel.scrollTo({ left: scrollPos, behavior: "smooth" });
                    };
                } catch (err) {
                    console.error("Error al cargar destacados:", err);
                }
            }

            cargarDestacados();
        </script>
        <script async type="application/javascript" src="https://a.pemsrv.com/ad-provider.js"></script>
        <ins class="eas6a97888e33" data-zoneid="5767754"></ins>
        <script>(AdProvider = window.AdProvider || []).push({ "serve": {} });</script>
    </main>

    <footer>
        <p>© 2025 Manhwas Haven - Todos los derechos reservados.</p>
    </footer>
    <script>
        const user = localStorage.getItem("usuario");
        if (user) {
            document.getElementById("user-actions").innerHTML = `
        <span>Hola, ${user}</span>
        <a href="#" onclick="cerrarSesion()">Cerrar sesión</a>
      `;
        }

        function cerrarSesion() {
            localStorage.clear();
            window.location.reload();
        }
    </script>
</body>
</html>
